{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\Juha\\\\Desktop\\\\Full_stack_open_2018\\\\5\\\\5.1-\\\\src\\\\App.js\";\nimport React from 'react';\nimport './index.css';\nimport Blog from './components/Blog';\nimport Button from './components/Button';\nimport FormLogin from './components/FormLogin';\nimport FormAddBlog from './components/FormAddBlog';\nimport Togglable from './components/Togglable';\nimport blogService from './services/blogs';\nimport loginService from './services/login';\n\nvar Notification = function Notification(_ref) {\n  var message = _ref.message;\n\n  if (message === null) {\n    return null;\n  }\n\n  return React.createElement(\"div\", {\n    className: \"status\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 16\n    },\n    __self: this\n  }, message, React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 18\n    },\n    __self: this\n  }));\n};\n\nvar App =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(App, _React$Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _this.login =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(event) {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n                _context.prev = 1;\n                _context.next = 4;\n                return loginService.login({\n                  username: _this.state.username,\n                  password: _this.state.password\n                });\n\n              case 4:\n                user = _context.sent;\n                window.localStorage.setItem('loggedUser', JSON.stringify(user));\n                blogService.setToken(user.token);\n\n                _this.setState({\n                  username: '',\n                  password: '',\n                  user: user\n                });\n\n                _context.next = 13;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](1);\n\n                _this.setStatusMessage('Invalid password or username');\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 10]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.logout = function () {\n      window.localStorage.removeItem('loggedUser');\n\n      _this.setState({\n        user: null\n      });\n    };\n\n    _this.handleInputFieldChange = function (event) {\n      _this.setState(_defineProperty({}, event.target.name, event.target.value));\n    };\n\n    _this.state = {\n      blogs: [],\n      username: '',\n      password: '',\n      user: null,\n      error: null,\n      statusMessage: null\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getBlogs();\n      var loggedUserJSON = window.localStorage.getItem('loggedUser');\n\n      if (loggedUserJSON) {\n        var user = JSON.parse(loggedUserJSON);\n        blogService.setToken(user.token);\n        this.setState({\n          user: user\n        });\n      }\n    }\n  }, {\n    key: \"setStatusMessage\",\n    value: function setStatusMessage(message) {\n      var _this2 = this;\n\n      this.setState({\n        statusMessage: message\n      });\n      setTimeout(function () {\n        _this2.setState({\n          statusMessage: null\n        });\n      }, 5000);\n    }\n  }, {\n    key: \"getBlogs\",\n    value: function () {\n      var _getBlogs = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var blogs;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return blogService.getAll();\n\n              case 2:\n                blogs = _context2.sent;\n                blogs.sort(function (a, b) {\n                  return b.likes - a.likes;\n                });\n                this.setState({\n                  blogs: blogs\n                }); // console.log(blogs)\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function getBlogs() {\n        return _getBlogs.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"showLoginForm\",\n    value: function showLoginForm() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, React.createElement(Togglable, {\n        buttonLabel: \"Start login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }, React.createElement(FormLogin, {\n        onSubmit: this.login,\n        handleLoginFieldChange: this.handleInputFieldChange,\n        password: this.state.password,\n        username: this.state.username,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      })));\n    }\n  }, {\n    key: \"showBlogsAndUser\",\n    value: function showBlogsAndUser() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      }, \"Logged in as: \", this.state.user.username, \" \", React.createElement(Button, {\n        text: 'Log out',\n        onClick: this.logout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      })), React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, \"blogs\"), this.state.blogs.map(function (blog) {\n        return React.createElement(Blog, {\n          key: blog._id,\n          blog: blog,\n          update: _this3.getBlogs.bind(_this3),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 99\n          },\n          __self: this\n        });\n      }), React.createElement(FormAddBlog, {\n        update: this.getBlogs.bind(this),\n        setStatusMessage: this.setStatusMessage.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      console.log(\"rendering\");\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      }, React.createElement(Notification, {\n        message: this.state.statusMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }), this.state.user === null ? this.showLoginForm() : this.showBlogsAndUser());\n    }\n  }]);\n\n  return App;\n}(React.Component);\n\nexport default App;","map":{"version":3,"sources":["C:\\Users\\Juha\\Desktop\\Full_stack_open_2018\\5\\5.1-\\src\\App.js"],"names":["React","Blog","Button","FormLogin","FormAddBlog","Togglable","blogService","loginService","Notification","message","App","props","login","event","preventDefault","username","state","password","user","window","localStorage","setItem","JSON","stringify","setToken","token","setState","setStatusMessage","logout","removeItem","handleInputFieldChange","target","name","value","blogs","error","statusMessage","getBlogs","loggedUserJSON","getItem","parse","setTimeout","getAll","sort","a","b","likes","map","blog","_id","bind","console","log","showLoginForm","showBlogsAndUser","Component"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,aAAP;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,WAAP,MAAwB,0BAAxB;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,WAAP,MAAwB,kBAAxB;AACA,OAAOC,YAAP,MAAyB,kBAAzB;;AAEA,IAAMC,YAAY,GAAG,SAAfA,YAAe,OAAiB;AAAA,MAAdC,OAAc,QAAdA,OAAc;;AACpC,MAAIA,OAAO,KAAK,IAAhB,EAAsB;AACpB,WAAO,IAAP;AACD;;AACD,SACE;AAAK,IAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGA,OADH,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF;AAMD,CAVD;;IAYMC,G;;;;;AACJ,eAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,6EAAMA,KAAN;;AADiB,UAkCnBC,KAlCmB;AAAA;AAAA;AAAA;AAAA;AAAA,+BAkCX,iBAAOC,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACNA,gBAAAA,KAAK,CAACC,cAAN;AADM;AAAA;AAAA,uBAGeP,YAAY,CAACK,KAAb,CAAmB;AACpCG,kBAAAA,QAAQ,EAAE,MAAKC,KAAL,CAAWD,QADe;AAEpCE,kBAAAA,QAAQ,EAAE,MAAKD,KAAL,CAAWC;AAFe,iBAAnB,CAHf;;AAAA;AAGEC,gBAAAA,IAHF;AAOJC,gBAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,YAA5B,EAA0CC,IAAI,CAACC,SAAL,CAAeL,IAAf,CAA1C;AACAZ,gBAAAA,WAAW,CAACkB,QAAZ,CAAqBN,IAAI,CAACO,KAA1B;;AACA,sBAAKC,QAAL,CAAc;AAAEX,kBAAAA,QAAQ,EAAE,EAAZ;AAAgBE,kBAAAA,QAAQ,EAAE,EAA1B;AAA8BC,kBAAAA,IAAI,EAAJA;AAA9B,iBAAd;;AATI;AAAA;;AAAA;AAAA;AAAA;;AAWJ,sBAAKS,gBAAL,CAAsB,8BAAtB;;AAXI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAlCW;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAgDnBC,MAhDmB,GAgDV,YAAM;AACbT,MAAAA,MAAM,CAACC,YAAP,CAAoBS,UAApB,CAA+B,YAA/B;;AACA,YAAKH,QAAL,CAAc;AAAER,QAAAA,IAAI,EAAE;AAAR,OAAd;AACD,KAnDkB;;AAAA,UAoDnBY,sBApDmB,GAoDM,UAACjB,KAAD,EAAW;AAClC,YAAKa,QAAL,qBAAiBb,KAAK,CAACkB,MAAN,CAAaC,IAA9B,EAAqCnB,KAAK,CAACkB,MAAN,CAAaE,KAAlD;AACD,KAtDkB;;AAEjB,UAAKjB,KAAL,GAAa;AACXkB,MAAAA,KAAK,EAAE,EADI;AAEXnB,MAAAA,QAAQ,EAAE,EAFC;AAGXE,MAAAA,QAAQ,EAAE,EAHC;AAIXC,MAAAA,IAAI,EAAE,IAJK;AAKXiB,MAAAA,KAAK,EAAE,IALI;AAMXC,MAAAA,aAAa,EAAE;AANJ,KAAb;AAFiB;AAUlB;;;;wCACmB;AAClB,WAAKC,QAAL;AACA,UAAMC,cAAc,GAAGnB,MAAM,CAACC,YAAP,CAAoBmB,OAApB,CAA4B,YAA5B,CAAvB;;AACA,UAAID,cAAJ,EAAoB;AAClB,YAAMpB,IAAI,GAAGI,IAAI,CAACkB,KAAL,CAAWF,cAAX,CAAb;AACAhC,QAAAA,WAAW,CAACkB,QAAZ,CAAqBN,IAAI,CAACO,KAA1B;AACA,aAAKC,QAAL,CAAc;AAAER,UAAAA,IAAI,EAAJA;AAAF,SAAd;AACD;AACF;;;qCACgBT,O,EAAS;AAAA;;AACxB,WAAKiB,QAAL,CAAc;AAAEU,QAAAA,aAAa,EAAE3B;AAAjB,OAAd;AACAgC,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,MAAI,CAACf,QAAL,CAAc;AAAEU,UAAAA,aAAa,EAAE;AAAjB,SAAd;AACD,OAFS,EAEP,IAFO,CAAV;AAGD;;;;;;;;;;;;;uBAEqB9B,WAAW,CAACoC,MAAZ,E;;;AAAdR,gBAAAA,K;AACNA,gBAAAA,KAAK,CAACS,IAAN,CAAW,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACnB,yBAAOA,CAAC,CAACC,KAAF,GAAUF,CAAC,CAACE,KAAnB;AACD,iBAFD;AAGA,qBAAKpB,QAAL,CAAc;AAAEQ,kBAAAA,KAAK,EAALA;AAAF,iBAAd,E,CACA;;;;;;;;;;;;;;;;oCAwBc;AACd,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,SAAD;AAAW,QAAA,WAAW,EAAC,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,SAAD;AACE,QAAA,QAAQ,EAAE,KAAKtB,KADjB;AAEE,QAAA,sBAAsB,EAAE,KAAKkB,sBAF/B;AAGE,QAAA,QAAQ,EAAE,KAAKd,KAAL,CAAWC,QAHvB;AAIE,QAAA,QAAQ,EAAE,KAAKD,KAAL,CAAWD,QAJvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CADF;AAWD;;;uCACkB;AAAA;;AACjB,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAoB,KAAKC,KAAL,CAAWE,IAAX,CAAgBH,QAApC,OAA8C,oBAAC,MAAD;AAAQ,QAAA,IAAI,EAAE,SAAd;AAAyB,QAAA,OAAO,EAAE,KAAKa,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAA9C,CADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAFF,EAGG,KAAKZ,KAAL,CAAWkB,KAAX,CAAiBa,GAAjB,CAAqB,UAAAC,IAAI;AAAA,eACxB,oBAAC,IAAD;AAAM,UAAA,GAAG,EAAEA,IAAI,CAACC,GAAhB;AAAqB,UAAA,IAAI,EAAED,IAA3B;AAAiC,UAAA,MAAM,EAAE,MAAI,CAACX,QAAL,CAAca,IAAd,CAAmB,MAAnB,CAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADwB;AAAA,OAAzB,CAHH,EAME,oBAAC,WAAD;AAAa,QAAA,MAAM,EAAE,KAAKb,QAAL,CAAca,IAAd,CAAmB,IAAnB,CAArB;AAA+C,QAAA,gBAAgB,EAAE,KAAKvB,gBAAL,CAAsBuB,IAAtB,CAA2B,IAA3B,CAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANF,CADF;AAUD;;;6BACQ;AACPC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,YAAD;AAAc,QAAA,OAAO,EAAE,KAAKpC,KAAL,CAAWoB,aAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAEG,KAAKpB,KAAL,CAAWE,IAAX,KAAoB,IAApB,GACE,KAAKmC,aAAL,EADF,GAEG,KAAKC,gBAAL,EAJN,CADF;AAUD;;;;EA9FetD,KAAK,CAACuD,S;;AAiGxB,eAAe7C,GAAf","sourcesContent":["import React from 'react'\r\nimport './index.css'\r\nimport Blog from './components/Blog'\r\nimport Button from './components/Button'\r\nimport FormLogin from './components/FormLogin'\r\nimport FormAddBlog from './components/FormAddBlog'\r\nimport Togglable from './components/Togglable'\r\nimport blogService from './services/blogs'\r\nimport loginService from './services/login'\r\n\r\nconst Notification = ({ message }) => {\r\n  if (message === null) {\r\n    return null\r\n  }\r\n  return (\r\n    <div className=\"status\">\r\n      {message}\r\n      <br></br>\r\n    </div>\r\n  )\r\n}\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      blogs: [],\r\n      username: '',\r\n      password: '',\r\n      user: null,\r\n      error: null,\r\n      statusMessage: null\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    this.getBlogs()\r\n    const loggedUserJSON = window.localStorage.getItem('loggedUser')\r\n    if (loggedUserJSON) {\r\n      const user = JSON.parse(loggedUserJSON)\r\n      blogService.setToken(user.token)\r\n      this.setState({ user })\r\n    }\r\n  }\r\n  setStatusMessage(message) {\r\n    this.setState({ statusMessage: message })\r\n    setTimeout(() => {\r\n      this.setState({ statusMessage: null })\r\n    }, 5000)\r\n  }\r\n  async getBlogs() {\r\n    const blogs = await blogService.getAll()\r\n    blogs.sort((a, b) => {\r\n      return b.likes - a.likes\r\n    })\r\n    this.setState({ blogs})\r\n    // console.log(blogs)\r\n  }\r\n  login = async (event) => {\r\n    event.preventDefault()\r\n    try {\r\n      const user = await loginService.login({\r\n        username: this.state.username,\r\n        password: this.state.password\r\n      })\r\n      window.localStorage.setItem('loggedUser', JSON.stringify(user))\r\n      blogService.setToken(user.token)\r\n      this.setState({ username: '', password: '', user })\r\n    } catch (ex) {\r\n      this.setStatusMessage('Invalid password or username')\r\n    }\r\n  }\r\n  logout = () => {\r\n    window.localStorage.removeItem('loggedUser')\r\n    this.setState({ user: null })\r\n  }\r\n  handleInputFieldChange = (event) => {\r\n    this.setState({ [event.target.name]: event.target.value })\r\n  }\r\n\r\n  showLoginForm() {\r\n    return (\r\n      <div>\r\n        <Togglable buttonLabel=\"Start login\">\r\n          <FormLogin\r\n            onSubmit={this.login}\r\n            handleLoginFieldChange={this.handleInputFieldChange}\r\n            password={this.state.password}\r\n            username={this.state.username} />\r\n        </Togglable>\r\n      </div>\r\n    )\r\n  }\r\n  showBlogsAndUser() {\r\n    return (\r\n      <div>\r\n        <div>Logged in as: {this.state.user.username} <Button text={'Log out'} onClick={this.logout} /></div>\r\n        <h2>blogs</h2>\r\n        {this.state.blogs.map(blog =>\r\n          <Blog key={blog._id} blog={blog} update={this.getBlogs.bind(this)} />\r\n        )}\r\n        <FormAddBlog update={this.getBlogs.bind(this)} setStatusMessage={this.setStatusMessage.bind(this)} />\r\n      </div>\r\n    )\r\n  }\r\n  render() {\r\n    console.log(\"rendering\")\r\n    return (\r\n      <div>\r\n        <Notification message={this.state.statusMessage} />\r\n        {this.state.user === null ?\r\n           this.showLoginForm() : \r\n            this.showBlogsAndUser()}\r\n        \r\n\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}